<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Quote</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      color: #191919;
    }

    .box {
      border-left: 4px solid #6c5ce7;
      padding: 12px 16px;
      background: #191919;
      border-radius: 8px;
    }

    .quote {
      font-size: 1.1rem;
      line-height: 1.5;
      margin: 0 0 8px;
      color: white;
    }

    .author {
      color: white;
      text-align: right;
      margin: 0;
    }

    .meta {
      font-size: 12px;
      color: #888;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <div class="box">
    <p class="quote">Loading inspirational quote…</p>
    <p class="author"></p>
    <!-- <div class="meta">Refresh to see a new one</div> -->
  </div>

  <script>
    const quoteEl = document.querySelector('.quote');
    const authorEl = document.querySelector('.author');

    // Optional local fallback if all APIs fail
    const localFallback = [
      { content: "Stay hungry, stay foolish.", author: "Steve Jobs" },
      { content: "The only way out is through.", author: "Robert Frost" },
      { content: "Do or do not. There is no try.", author: "Yoda" },
      { content: "Make it work, make it right, make it fast.", author: "Kent Beck" }
    ];

    // Providers to try in order. Each returns a normalized { content, author }.
    const providers = [
      // 1) ZenQuotes
      async () => {
        const r = await fetch('https://zenquotes.io/api/random', {
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          credentials: 'omit',
          cache: 'no-store'
        });
        if (!r.ok) throw new Error(`ZenQuotes HTTP ${r.status}`);
        const arr = await r.json();
        const q = Array.isArray(arr) && arr[0] ? arr : null;
        if (!q || !q.q) throw new Error('ZenQuotes malformed');
        return { content: q.q, author: q.a || 'Unknown' };
      },

      // 2) FavQs Quote of the Day
      async () => {
        const r = await fetch('https://favqs.com/api/qotd', {
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          credentials: 'omit',
          cache: 'no-store'
        });
        if (!r.ok) throw new Error(`FavQs HTTP ${r.status}`);
        const j = await r.json();
        const q = j && j.quote;
        if (!q || !q.body) throw new Error('FavQs malformed');
        return { content: q.body, author: q.author || 'Unknown' };
      },

      // 3) Programming Quotes (dev-themed)
      async () => {
        const r = await fetch('https://programming-quotesapi.vercel.app/api/random', {
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          credentials: 'omit',
          cache: 'no-store'
        });
        if (!r.ok) throw new Error(`ProgrammingQuotes HTTP ${r.status}`);
        const j = await r.json();
        if (!j || !j.quote) throw new Error('ProgrammingQuotes malformed');
        return { content: j.quote, author: j.author || 'Unknown' };
      },

      // 4) Quotable (kept last since you saw TLS issues locally)
      async () => {
        const r = await fetch('https://api.quotable.io/random', {
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          credentials: 'omit',
          cache: 'no-store'
        });
        if (!r.ok) throw new Error(`Quotable HTTP ${r.status}`);
        const j = await r.json();
        if (!j || !j.content) throw new Error('Quotable malformed');
        return { content: j.content, author: j.author || 'Unknown' };
      }
    ];

    async function getQuoteWithFallback() {
      const errors = [];
      for (const provider of providers) {
        try {
          const q = await provider();
          return q;
        } catch (e) {
          errors.push(String(e?.message || e));
        }
      }
      // If everything failed, use a local fallback
      if (localFallback.length) {
        const q = localFallback[Math.floor(Math.random() * localFallback.length)];
        return { ...q, _fallback: true, _errors: errors };
      }
      // If no local fallback, throw with accumulated errors
      throw new Error('All providers failed: ' + errors.join(' | '));
    }

    async function loadQuote() {
      try {
        // Small delay can help WebViews (Notion app) initialize network
        await new Promise(r => setTimeout(r, 50));

        const data = await getQuoteWithFallback();

        // Render
        quoteEl.textContent = `“${data.content}”`;
        authorEl.textContent = data.author ? `— ${data.author}` : '— Unknown';

        // If it came from local fallback, you can optionally note it in console
        if (data._fallback) {
          console.warn('Using local fallback due to errors:', data._errors);
        }
      } catch (e) {
        quoteEl.textContent = 'Oops! Failed to load a quote.';
        authorEl.textContent = String(e?.message || e || '');
        console.error('Quote load error:', e);
      }
    }

    loadQuote();
  </script>

</body>

</html>